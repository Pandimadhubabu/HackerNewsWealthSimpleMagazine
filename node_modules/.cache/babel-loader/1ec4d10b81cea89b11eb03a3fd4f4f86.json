{"ast":null,"code":"import _taggedTemplateLiteral from \"C:\\\\Projects\\\\WealthSimple\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/taggedTemplateLiteral\";\nimport _toConsumableArray from \"C:\\\\Projects\\\\WealthSimple\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"C:\\\\Projects\\\\WealthSimple\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"C:\\\\Projects\\\\WealthSimple\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Projects\\\\WealthSimple\\\\src\\\\Components\\\\Stories\\\\InfiniteStories.js\";\n\nfunction _templateObject10() {\n  var data = _taggedTemplateLiteral([\"\\n    font-family: FuturaBT-Heavy, sans-serif;\\n    font-size: 14px;\\n    font-weight: 100;\\n    letter-spacing: 2px;\\n    opacity: 0.4;\\n    text-transform: uppercase;\\n  \"]);\n\n  _templateObject10 = function _templateObject10() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"\\n    font-family: FuturaBT-Heavy, sans-serif;\\n    font-size: inherit;\\n    font-weight: 100;\\n    font-size: 24px;\\n    letter-spacing: -0.03em;\\n    line-height: 32px;\\n    margin: 10px 0 20px;\\n  \"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\\n    background: #fff;\\n    clear: both;\\n    line-height: 28px;\\n    padding: 30px 30px 15px;\\n  \"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n    left: 0;\\n    position: absolute;\\n    top: 0;\\n    width: 100%;\\n    float: left;\\n    width: 100%;\\n  \"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n    display: block;\\n    height: 0;\\n    overflow: hidden;\\n    padding-bottom: 60%;\\n    position: relative;\\n    width: 100%;\\n    background-color: white;\\n  \"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n    color: inherit;\\n    text-decoration: none;\\n  \"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n    background: #f2efeb;\\n    margin-bottom: 20px;\\n    position: relative;\\n    width: 100%;\\n    @media (min-width: 620px) {\\n      width: calc(50% - 10px);\\n      margin-left: 10px;\\n    }\\n    float: left;\\n    &:nth-child(odd) {\\n      clear: both;\\n      display: table;\\n    }\\n  \"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    position: relative;\\n    margin: 40px auto 0;\\n    width: 100%;\\n  \"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    bottom: 0;\\n    left: 50%;\\n    margin-left: -90px;\\n    pointer-events: auto;\\n    position: absolute;\\n    width: 180px;\\n    font-family: FuturaBT-Book, sans-serif;\\n    font-size: 18px;\\n    font-weight: 300;\\n    background: #ffb21a;\\n    border-radius: 52px;\\n    color: #fff;\\n    padding: 16px 20px 15px;\\n    text-decoration: none;\\n    transition: background 80ms linear, opacity 1s linear;\\n    white-space: nowrap;\\n  \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    background: linear-gradient(hsla(0, 0%, 100%, 0), #f9f8f6);\\n    height: 390px;\\n    margin-top: -370px;\\n    pointer-events: none;\\n    position: relative;\\n    text-align: center;\\n    z-index: 2;\\n  \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport urlMetadata from \"url-metadata\";\nimport { DEFAULT_IMAGE } from \"./Constant\";\n\nvar InfiniteStories = function InfiniteStories(props) {\n  var _useState = useState(10),\n      _useState2 = _slicedToArray(_useState, 2),\n      pageSize = _useState2[0],\n      setPageSize = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      ids = _useState4[0],\n      setIds = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      evenIds = _useState6[0],\n      setEvenIds = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      oddIds = _useState8[0],\n      setOddIds = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      stories = _useState10[0],\n      setStories = _useState10[1];\n\n  var _useState11 = useState(0),\n      _useState12 = _slicedToArray(_useState11, 2),\n      lastId = _useState12[0],\n      setLastId = _useState12[1];\n\n  var _useState13 = useState(false),\n      _useState14 = _slicedToArray(_useState13, 2),\n      loading = _useState14[0],\n      setLoading = _useState14[1];\n\n  useEffect(function () {\n    console.log(\"Use effect called\");\n    var newLast = (lastId || 1) + pageSize;\n    setLastId(newLast);\n    var idToProcess = !props.filter ? ids : props.filter === \"even\" ? evenIds : oddIds;\n    if (!idToProcess || idToProcess.length === 0) return;\n    getNextPage(idToProcess, 0);\n  }, [props.filter]);\n  useEffect(function () {\n    getStories();\n  }, []);\n\n  var scrollListener = function scrollListener() {\n    console.log(\"loading\", loading);\n\n    if (!loading) {\n      var list = document.getElementById(\"list\");\n      var maxLimit = list.clientHeight + list.offsetTop;\n      var scrollPosition = window.scrollY + window.innerHeight;\n\n      if (scrollPosition >= maxLimit && scrollPosition < maxLimit + 10) {\n        // New page has to be loaded\n        var newLast = (lastId || 1) + pageSize;\n        setLastId(newLast);\n        setLoading(true);\n        newLast != 0 && getNextPage(ids, newLast);\n      }\n    }\n  };\n\n  useEffect(function () {\n    window.addEventListener(\"scroll\", scrollListener);\n    return function () {\n      window.removeEventListener(\"scroll\", scrollListener);\n    };\n  }, [loading, lastId]);\n\n  var getStories = function getStories() {\n    return fetch(\"https://hacker-news.firebaseio.com/v0/topstories.json?print=pretty\").then(function (res) {\n      return !res.ok ? res.json().then(function (e) {\n        return Promise.reject(e);\n      }) : res.json();\n    }).then(function (res) {\n      setIds(res);\n      setEvenIds(res.filter(function (id, index, arr) {\n        return (index + 1) % 2 === 0;\n      }));\n      setOddIds(res.filter(function (id, index, arr) {\n        return (index + 1) % 2 === 0;\n      }));\n      return res;\n    }).catch(console.log);\n  };\n\n  var loadedArticles = [];\n\n  var getNextPage = function getNextPage(ids, lastId) {\n    var proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n    loadedArticles = [];\n    var promises = [];\n    ids.filter(function (id, index, arr) {\n      return index >= lastId && index < (lastId || 1) + pageSize;\n    }).map(function (id) {\n      return promises.push(fetch(\"https://hacker-news.firebaseio.com/v0/item/\".concat(id, \".json\")).then(function (res) {\n        return !res.ok ? res.json().then(function (e) {\n          return Promise.reject(e);\n        }) : res.json();\n      }).then(function (res) {\n        return res.url && urlMetadata(proxyurl + res.url).then(function (metadata) {\n          // success handler\n          var image = metadata[\"og:image\"] || DEFAULT_IMAGE;\n\n          var story = _objectSpread({}, res, {\n            image: image\n          });\n\n          if (story.id === ids[0]) {\n            props.setFeature(story);\n          } else {\n            loadedArticles.push(story);\n          }\n        }, function (error) {\n          // failure handler\n          var story = _objectSpread({}, res, {\n            image: DEFAULT_IMAGE\n          });\n\n          loadedArticles.push(story);\n        });\n      }).catch(function (e) {\n        console.log(e);\n      }));\n    });\n    Promise.all(promises).then(function () {\n      setStories(function (prevState) {\n        return [].concat(_toConsumableArray(prevState), _toConsumableArray(loadedArticles));\n      });\n      setLoading(false);\n    });\n  }; //   useEffect(() => {}, []);\n\n\n  var LoadMoreDiv = styled.div(_templateObject());\n  var Button = styled.div(_templateObject2());\n  var UL = styled.ul(_templateObject3());\n  var LI = styled.li(_templateObject4());\n  var Anchor = styled.a(_templateObject5());\n  var ArticleContainer = styled.div(_templateObject6());\n  var ArticleImage = styled.img(_templateObject7());\n  var PostExcerpt = styled.div(_templateObject8());\n  var PostExcerptTitle = styled.h3(_templateObject9());\n  var PostCategory = styled.span(_templateObject10());\n  return React.createElement(\"section\", {\n    className: \"mt-24\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231\n    },\n    __self: this\n  }, React.createElement(UL, {\n    id: \"list\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232\n    },\n    __self: this\n  }, stories.map(function (story, index) {\n    return React.createElement(LI, {\n      key: index,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    }, React.createElement(Anchor, {\n      href: story.url,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, React.createElement(ArticleContainer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, React.createElement(ArticleImage, {\n      alt: \"1\",\n      src: story.image,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    })), React.createElement(PostExcerpt, {\n      className: \"post-excerpt\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, React.createElement(PostCategory, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }, \"Money Diaries\"), React.createElement(PostExcerptTitle, {\n      className: \"post-excerpt-title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }, story.title))));\n  }), React.createElement(\"li\", {\n    style: {\n      clear: \"both\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    style: {\n      clear: \"both\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252\n    },\n    __self: this\n  }), React.createElement(LoadMoreDiv, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253\n    },\n    __self: this\n  }, React.createElement(Button, {\n    href: \"#\",\n    \"data-category\": \"?category_id=money-diaries\",\n    disabled: loading,\n    onClick: function onClick() {\n      setLastId(function (p) {\n        return p || 1 + pageSize;\n      });\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254\n    },\n    __self: this\n  }, loading ? \"Loading\" : \"More posts\")));\n};\n\nexport default InfiniteStories;","map":{"version":3,"sources":["C:/Projects/WealthSimple/src/Components/Stories/InfiniteStories.js"],"names":["React","useState","useEffect","styled","urlMetadata","DEFAULT_IMAGE","InfiniteStories","props","pageSize","setPageSize","ids","setIds","evenIds","setEvenIds","oddIds","setOddIds","stories","setStories","lastId","setLastId","loading","setLoading","console","log","newLast","idToProcess","filter","length","getNextPage","getStories","scrollListener","list","document","getElementById","maxLimit","clientHeight","offsetTop","scrollPosition","window","scrollY","innerHeight","addEventListener","removeEventListener","fetch","then","res","ok","json","e","Promise","reject","id","index","arr","catch","loadedArticles","proxyurl","promises","map","push","url","metadata","image","story","setFeature","error","all","prevState","LoadMoreDiv","div","Button","UL","ul","LI","li","Anchor","a","ArticleContainer","ArticleImage","img","PostExcerpt","PostExcerptTitle","h3","PostCategory","span","title","clear","p"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport urlMetadata from \"url-metadata\";\r\nimport { DEFAULT_IMAGE } from \"./Constant\";\r\n\r\nconst InfiniteStories = props => {\r\n  const [pageSize, setPageSize] = useState(10);\r\n  const [ids, setIds] = useState([]);\r\n  const [evenIds, setEvenIds] = useState([]);\r\n  const [oddIds, setOddIds] = useState([]);\r\n  const [stories, setStories] = useState([]);\r\n  const [lastId, setLastId] = useState(0);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    console.log(\"Use effect called\");\r\n    let newLast = (lastId || 1) + pageSize;\r\n    setLastId(newLast);\r\n    let idToProcess = !props.filter\r\n      ? ids\r\n      : props.filter === \"even\"\r\n      ? evenIds\r\n      : oddIds;\r\n    if (!idToProcess || idToProcess.length === 0) return;\r\n    getNextPage(idToProcess, 0);\r\n  }, [props.filter]);\r\n\r\n  useEffect(() => {\r\n    getStories();\r\n  }, []);\r\n\r\n  const scrollListener = () => {\r\n    console.log(\"loading\", loading);\r\n    if (!loading) {\r\n      const list = document.getElementById(\"list\");\r\n      const maxLimit = list.clientHeight + list.offsetTop;\r\n      const scrollPosition = window.scrollY + window.innerHeight;\r\n      if (scrollPosition >= maxLimit && scrollPosition < maxLimit + 10) {\r\n        // New page has to be loaded\r\n        let newLast = (lastId || 1) + pageSize;\r\n        setLastId(newLast);\r\n        setLoading(true);\r\n        newLast != 0 && getNextPage(ids, newLast);\r\n      }\r\n    }\r\n  };\r\n  useEffect(() => {\r\n    window.addEventListener(\"scroll\", scrollListener);\r\n    return () => {\r\n      window.removeEventListener(\"scroll\", scrollListener);\r\n    };\r\n  }, [loading, lastId]);\r\n\r\n  const getStories = () => {\r\n    return fetch(\r\n      \"https://hacker-news.firebaseio.com/v0/topstories.json?print=pretty\"\r\n    )\r\n      .then(res => {\r\n        return !res.ok ? res.json().then(e => Promise.reject(e)) : res.json();\r\n      })\r\n      .then(res => {\r\n        setIds(res);\r\n        setEvenIds(\r\n          res.filter((id, index, arr) => {\r\n            return (index + 1) % 2 === 0;\r\n          })\r\n        );\r\n        setOddIds(\r\n          res.filter((id, index, arr) => {\r\n            return (index + 1) % 2 === 0;\r\n          })\r\n        );\r\n        return res;\r\n      })\r\n      .catch(console.log);\r\n  };\r\n  let loadedArticles = [];\r\n  const getNextPage = (ids, lastId) => {\r\n    const proxyurl = \"https://cors-anywhere.herokuapp.com/\";\r\n    loadedArticles = [];\r\n    let promises = [];\r\n    ids\r\n      .filter((id, index, arr) => {\r\n        return index >= lastId && index < (lastId || 1) + pageSize;\r\n      })\r\n      .map(id =>\r\n        promises.push(\r\n          fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`)\r\n            .then(res => {\r\n              return !res.ok\r\n                ? res.json().then(e => Promise.reject(e))\r\n                : res.json();\r\n            })\r\n            .then(res => {\r\n              return (\r\n                res.url &&\r\n                urlMetadata(proxyurl + res.url).then(\r\n                  function(metadata) {\r\n                    // success handler\r\n                    const image = metadata[\"og:image\"] || DEFAULT_IMAGE;\r\n                    const story = { ...res, image };\r\n                    if (story.id === ids[0]) {\r\n                      props.setFeature(story);\r\n                    } else {\r\n                      loadedArticles.push(story);\r\n                    }\r\n                  },\r\n                  function(error) {\r\n                    // failure handler\r\n                    const story = { ...res, image: DEFAULT_IMAGE };\r\n                    loadedArticles.push(story);\r\n                  }\r\n                )\r\n              );\r\n            })\r\n            .catch(e => {\r\n              console.log(e);\r\n            })\r\n        )\r\n      );\r\n    Promise.all(promises).then(function() {\r\n      setStories(prevState => [...prevState, ...loadedArticles]);\r\n      setLoading(false);\r\n    });\r\n  };\r\n\r\n  //   useEffect(() => {}, []);\r\n\r\n  const LoadMoreDiv = styled.div`\r\n    background: linear-gradient(hsla(0, 0%, 100%, 0), #f9f8f6);\r\n    height: 390px;\r\n    margin-top: -370px;\r\n    pointer-events: none;\r\n    position: relative;\r\n    text-align: center;\r\n    z-index: 2;\r\n  `;\r\n\r\n  const Button = styled.div`\r\n    bottom: 0;\r\n    left: 50%;\r\n    margin-left: -90px;\r\n    pointer-events: auto;\r\n    position: absolute;\r\n    width: 180px;\r\n    font-family: FuturaBT-Book, sans-serif;\r\n    font-size: 18px;\r\n    font-weight: 300;\r\n    background: #ffb21a;\r\n    border-radius: 52px;\r\n    color: #fff;\r\n    padding: 16px 20px 15px;\r\n    text-decoration: none;\r\n    transition: background 80ms linear, opacity 1s linear;\r\n    white-space: nowrap;\r\n  `;\r\n\r\n  const UL = styled.ul`\r\n    position: relative;\r\n    margin: 40px auto 0;\r\n    width: 100%;\r\n  `;\r\n\r\n  const LI = styled.li`\r\n    background: #f2efeb;\r\n    margin-bottom: 20px;\r\n    position: relative;\r\n    width: 100%;\r\n    @media (min-width: 620px) {\r\n      width: calc(50% - 10px);\r\n      margin-left: 10px;\r\n    }\r\n    float: left;\r\n    &:nth-child(odd) {\r\n      clear: both;\r\n      display: table;\r\n    }\r\n  `;\r\n\r\n  const Anchor = styled.a`\r\n    color: inherit;\r\n    text-decoration: none;\r\n  `;\r\n\r\n  const ArticleContainer = styled.div`\r\n    display: block;\r\n    height: 0;\r\n    overflow: hidden;\r\n    padding-bottom: 60%;\r\n    position: relative;\r\n    width: 100%;\r\n    background-color: white;\r\n  `;\r\n\r\n  const ArticleImage = styled.img`\r\n    left: 0;\r\n    position: absolute;\r\n    top: 0;\r\n    width: 100%;\r\n    float: left;\r\n    width: 100%;\r\n  `;\r\n\r\n  const PostExcerpt = styled.div`\r\n    background: #fff;\r\n    clear: both;\r\n    line-height: 28px;\r\n    padding: 30px 30px 15px;\r\n  `;\r\n\r\n  const PostExcerptTitle = styled.h3`\r\n    font-family: FuturaBT-Heavy, sans-serif;\r\n    font-size: inherit;\r\n    font-weight: 100;\r\n    font-size: 24px;\r\n    letter-spacing: -0.03em;\r\n    line-height: 32px;\r\n    margin: 10px 0 20px;\r\n  `;\r\n\r\n  const PostCategory = styled.span`\r\n    font-family: FuturaBT-Heavy, sans-serif;\r\n    font-size: 14px;\r\n    font-weight: 100;\r\n    letter-spacing: 2px;\r\n    opacity: 0.4;\r\n    text-transform: uppercase;\r\n  `;\r\n  return (\r\n    <section className=\"mt-24\">\r\n      <div>\r\n        <UL id=\"list\">\r\n          {stories.map((story, index) => (\r\n            <LI key={index}>\r\n              <Anchor href={story.url}>\r\n                <ArticleContainer>\r\n                  <ArticleImage alt=\"1\" src={story.image} />\r\n                </ArticleContainer>\r\n\r\n                <PostExcerpt className=\"post-excerpt\">\r\n                  <PostCategory>Money Diaries</PostCategory>\r\n                  <PostExcerptTitle className=\"post-excerpt-title\">\r\n                    {story.title}\r\n                  </PostExcerptTitle>\r\n                </PostExcerpt>\r\n              </Anchor>\r\n            </LI>\r\n          ))}\r\n          <li style={{ clear: \"both\" }}></li>\r\n        </UL>\r\n      </div>\r\n      <div style={{ clear: \"both\" }}></div>\r\n      <LoadMoreDiv>\r\n        <Button\r\n          href=\"#\"\r\n          data-category=\"?category_id=money-diaries\"\r\n          disabled={loading}\r\n          onClick={() => {\r\n            setLastId(p => p || 1 + pageSize);\r\n          }}\r\n        >\r\n          {loading ? \"Loading\" : \"More posts\"}\r\n        </Button>\r\n      </LoadMoreDiv>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default InfiniteStories;\r\n"]},"metadata":{},"sourceType":"module"}